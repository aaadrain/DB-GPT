(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5498],{55286:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/database",function(){return t(99473)}])},26892:function(e,s,t){"use strict";var l=t(85893),a=t(67294),r=t(66309),n=t(83062),i=t(93967),d=t.n(i),c=t(25675),o=t.n(c);s.Z=(0,a.memo)(function(e){let{icon:s,iconBorder:t=!0,title:i,desc:c,tags:m,children:u,disabled:x,operations:p,className:b,...h}=e,f=(0,a.useMemo)(()=>s?"string"==typeof s?(0,l.jsx)(o(),{className:d()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":t}),width:44,height:44,src:s,alt:i}):s:null,[s]),j=(0,a.useMemo)(()=>m&&m.length?(0,l.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:m.map((e,s)=>{var t;return"string"==typeof e?(0,l.jsx)(r.Z,{className:"text-xs",bordered:!1,color:"default",children:e},s):(0,l.jsx)(r.Z,{className:"text-xs",bordered:null!==(t=e.border)&&void 0!==t&&t,color:e.color,children:e.text},s)})}):null,[m]);return(0,l.jsxs)("div",{className:d()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":x,"cursor-pointer":!x&&!!h.onClick},b),...h,children:[(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[f,(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("h2",{className:"text-sm font-semibold",children:i}),j]})]}),c&&(0,l.jsx)(n.Z,{title:c,children:(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:c})})]}),(0,l.jsxs)("div",{children:[u,p&&!!p.length&&(0,l.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:p.map((e,s)=>(0,l.jsx)(n.Z,{title:e.label,children:(0,l.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:s=>{var t;s.stopPropagation(),null===(t=e.onClick)||void 0===t||t.call(e)},children:[e.children,s<p.length-1&&(0,l.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(s)))})]})]})})},45247:function(e,s,t){"use strict";var l=t(85893),a=t(50888);s.Z=function(e){let{visible:s}=e;return s?(0,l.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,l.jsx)(a.Z,{})}):null}},99473:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S},isFileDb:function(){return P}});var l=t(85893),a=t(67294),r=t(2093),n=t(17788),i=t(2453),d=t(14726),c=t(40411),o=t(85265),m=t(85813),u=t(32983),x=t(23323),p=t(66184),b=t(79531),h=t(10418),f=t(89182),j=t(67421),y=t(41468),_=function(e){let{open:s,choiceDBType:t,dbTypeList:r,editValue:c,dbNames:o,onClose:m,onSuccess:u}=e,[_,v]=(0,a.useState)(!1),{t:N}=(0,j.$G)(),[Z]=x.Z.useForm(),g=x.Z.useWatch("db_type",Z),{userId:w}=(0,a.useContext)(y.p),k=(0,a.useMemo)(()=>P(r,g),[r,g]);(0,a.useEffect)(()=>{t&&Z.setFieldValue("db_type",t)},[t]),(0,a.useEffect)(()=>{c&&Z.setFieldsValue({...c})},[c]),(0,a.useEffect)(()=>{s||Z.resetFields()},[s]);let C=async e=>{let{db_host:s,db_path:t,db_port:l,...a}=e;if(!c&&o.some(e=>e===a.db_name)){i.ZP.error("The database already exists!");return}let r={db_host:k?void 0:s,db_port:k?void 0:l,file_path:k?t:void 0,user_id:w,...a};v(!0);try{let[e]=await (0,f.Vx)((0,f.KS)(r));if(e)return;let[s]=await (0,f.Vx)((c?f.mR:f.b_)(r));if(s){i.ZP.error(s.message);return}i.ZP.success("success"),null==u||u()}catch(e){i.ZP.error(e.message)}finally{v(!1)}},S=(0,a.useMemo)(()=>!!c||!!t,[c,t]);return(0,l.jsx)(n.default,{open:s,width:400,title:N(c?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:m,children:(0,l.jsxs)(x.Z,{form:Z,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:C,children:[(0,l.jsx)(x.Z.Item,{name:"db_type",label:"DB Type",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(p.default,{"aria-readonly":S,disabled:S,options:r})}),(0,l.jsx)(x.Z.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(b.default,{readOnly:!!c,disabled:!!c})}),!0===k&&(0,l.jsx)(x.Z.Item,{name:"db_path",label:"Path",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(b.default,{})}),!1===k&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Z.Item,{name:"db_user",label:"Username",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(b.default,{})}),(0,l.jsx)(x.Z.Item,{name:"db_pwd",label:"Password",className:"mb-3",rules:[{required:!1}],children:(0,l.jsx)(b.default,{type:"password"})}),(0,l.jsx)(x.Z.Item,{name:"db_host",label:"Host",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(b.default,{})}),(0,l.jsx)(x.Z.Item,{name:"db_port",label:"Port",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(h.Z,{min:1,step:1,max:65535})})]}),(0,l.jsx)(x.Z.Item,{name:"comment",label:"Remark",className:"mb-3",children:(0,l.jsx)(b.default,{})}),(0,l.jsxs)(x.Z.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,l.jsx)(d.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:_,children:"Save"}),(0,l.jsx)(d.ZP,{size:"middle",onClick:m,children:"Cancel"})]})]})})},v=t(24969),N=t(36531),Z=t(27704),g=t(45247),w=t(62418),k=t(26892),C=t(11163);function P(e,s){var t;return null===(t=e.find(e=>e.value===s))||void 0===t?void 0:t.isFileDb}var S=function(){var e;let s=(0,C.useRouter)(),{userId:t}=(0,a.useContext)(y.p)||localStorage.getItem("userId")||s.query.userId||s.query.userid||"",{t:x}=(0,j.$G)(),[p,b]=(0,a.useState)([]),[h,P]=(0,a.useState)([]),[S,E]=(0,a.useState)(!1),[F,I]=(0,a.useState)({open:!1}),[T,q]=(0,a.useState)({open:!1}),D=async()=>{let[,e]=await (0,f.Vx)((0,f.Jm)());P(null!=e?e:[])},V=async()=>{E(!0);let[,e]=await (0,f.Vx)((0,f.Bw)(t));b(null!=e?e:[]),E(!1)},M=(0,a.useMemo)(()=>{let e=h.map(e=>{let{db_type:s,is_file_db:t}=e;return{...w.S$[s],value:s,isFileDb:t}}),s=Object.keys(w.S$).filter(s=>!e.some(e=>e.value===s)).map(e=>({...w.S$[e],value:w.S$[e].label,disabled:!0}));return[...e,...s]},[h]),$=e=>{I({open:!0,info:e})},O=e=>{n.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(s,t)=>{try{let[l]=await (0,f.Vx)((0,f.J5)(e.db_name));if(l){i.ZP.error(l.message),t();return}i.ZP.success("success"),V(),s()}catch(e){t()}})})},B=(0,a.useMemo)(()=>{let e=M.reduce((e,s)=>(e[s.value]=p.filter(e=>e.db_type===s.value),e),{});return e},[p,M]);(0,r.Z)(async()=>{await V(),await D()},[]);let R=e=>{let s=p.filter(s=>s.db_type===e.value);q({open:!0,dbList:s,name:e.label,type:e.value})};return(0,l.jsxs)("div",{className:"relative p-4 md:p-6 min-h-full overflow-y-auto",children:[(0,l.jsx)(g.Z,{visible:S}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(d.ZP,{type:"primary",className:"flex items-center",icon:(0,l.jsx)(v.Z,{}),onClick:()=>{I({open:!0})},children:x("create")})}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 md:gap-4",children:M.map(s=>(0,l.jsx)(c.Z,{count:B[s.value].length,className:"min-h-fit",children:(0,l.jsx)(k.Z,{className:"h-full",title:s.label,desc:null!==(e=s.desc)&&void 0!==e?e:"",disabled:s.disabled,icon:s.icon,onClick:()=>{s.disabled||R(s)}})},s.value))}),(0,l.jsx)(_,{open:F.open,dbTypeList:M,choiceDBType:F.dbType,editValue:F.info,dbNames:p.map(e=>e.db_name),onSuccess:()=>{I({open:!1}),V()},onClose:()=>{I({open:!1})}}),(0,l.jsx)(o.Z,{title:T.name,placement:"right",onClose:()=>{q({open:!1})},open:T.open,children:T.type&&B[T.type]&&B[T.type].length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,l.jsx)(v.Z,{}),onClick:()=>{I({open:!0,dbType:T.type})},children:"Create"}),B[T.type].map(e=>(0,l.jsxs)(m.Z,{title:e.db_name,extra:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{$(e)}}),(0,l.jsx)(Z.Z,{style:{color:"#ff1b2e"},onClick:()=>{O(e)}})]}),className:"mb-4",children:[e.db_path?(0,l.jsxs)("p",{children:["path: ",e.db_path]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["host: ",e.db_host]}),(0,l.jsxs)("p",{children:["username: ",e.db_user]}),(0,l.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,l.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,l.jsx)(u.Z,{image:u.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(d.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(v.Z,{}),onClick:()=>{I({open:!0,dbType:T.type})},children:"Create Now"})})})]})}}},function(e){e.O(0,[6274,5503,3323,6184,2398,5813,418,411,7902,9774,2888,179],function(){return e(e.s=55286)}),_N_E=e.O()}]);