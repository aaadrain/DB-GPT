(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5405],{48312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(57464)}])},81799:function(e,t,n){"use strict";n.d(t,{A:function(){return d}});var a=n(85893),s=n(41468),r=n(66184),l=n(19284),o=n(25675),c=n.n(o),i=n(67294),u=n(67421);function d(e,t){var n;let{width:s,height:r}=t||{};return e?(0,a.jsx)(c(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:r||24,src:(null===(n=l.H[e])||void 0===n?void 0:n.icon)||"/models/huggingface.svg",alt:"llm"}):null}t.Z=function(e){let{onChange:t}=e,{t:n}=(0,u.$G)(),{modelList:o,model:c}=(0,i.useContext)(s.p);return!o||o.length<=0?null:(0,a.jsx)(r.default,{value:c,placeholder:n("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:o.map(e=>{var t;return(0,a.jsx)(r.default.Option,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[d(e),(0,a.jsx)("span",{className:"ml-2",children:(null===(t=l.H[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},19409:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var a=n(85893),s=n(27496),r=n(79531),l=n(14726),o=n(67294),c=n(2487),i=n(83062),u=n(2453),d=n(28459),m=n(55241),h=n(23323),p=n(66184),x=n(58299),f=n(577),_=n(30119),g=n(67421),j=n(41468);let w=e=>{let{data:t,loading:n,submit:s,close:r}=e,{t:l}=(0,g.$G)(),o=e=>()=>{s(e),r()};return(0,a.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,a.jsx)(c.Z,{dataSource:null==t?void 0:t.data,loading:n,rowKey:e=>e.prompt_name,renderItem:e=>(0,a.jsx)(c.Z.Item,{onClick:o(e.content),children:(0,a.jsx)(i.Z,{title:e.content,children:(0,a.jsx)(c.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:l("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+l("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var v=e=>{let{submit:t}=e,{t:n}=(0,g.$G)(),[s,r]=(0,o.useState)(!1),[l,c]=(0,o.useState)("common"),{userId:v}=(0,o.useContext)(j.p),{data:y,loading:b}=(0,f.Z)(()=>{let e={prompt_type:l};return"common"!==l&&(e.user_name=v),(0,_.PR)("/prompt/list",e)},{refreshDeps:[l],onError:e=>{u.ZP.error(null==e?void 0:e.message)}});return(0,a.jsx)(d.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,a.jsx)(m.Z,{title:(0,a.jsx)(h.Z.Item,{label:"Prompt "+n("Type"),children:(0,a.jsx)(p.default,{style:{width:150},value:l,onChange:e=>{c(e)},options:[{label:n("Public")+" Prompts",value:"common"},{label:n("Private")+" Prompts",value:"private"}]})}),content:(0,a.jsx)(w,{data:y,loading:b,submit:t,close:()=>{r(!1)}}),placement:"topRight",trigger:"click",open:s,onOpenChange:e=>{r(e)},children:(0,a.jsx)(i.Z,{title:n("Click_Select")+" Prompt",children:(0,a.jsx)(x.Z,{className:"bottom-[30%]"})})})})},y=n(89182),b=n(80573),N=n(5392),Z=n(84553);function P(e){let{dbParam:t,setDocId:n}=(0,o.useContext)(j.p),{onUploadFinish:s,handleFinish:r}=e,c=(0,b.Z)(),[i,u]=(0,o.useState)(!1),d=async e=>{u(!0);let a=new FormData;a.append("doc_name",e.file.name),a.append("doc_file",e.file),a.append("doc_type","DOCUMENT");let l=await (0,y.Vx)((0,y.iG)(t||"default",a));if(!l[1]){u(!1);return}n(l[1]),s(),u(!1),null==r||r(!0),await c(l[1]),null==r||r(!1)};return(0,a.jsx)(Z.default,{customRequest:d,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,a.jsx)(l.ZP,{loading:i,size:"small",shape:"circle",icon:(0,a.jsx)(N.Z,{})})})}var k=n(11163),C=n(82353),S=n(1051);function I(e){let{document:t}=e;switch(t.status){case"RUNNING":return(0,a.jsx)(C.Rp,{});case"FINISHED":default:return(0,a.jsx)(C.s2,{});case"FAILED":return(0,a.jsx)(S.Z,{})}}function R(e){let{documents:t,dbParam:n}=e,s=(0,k.useRouter)(),r=e=>{s.push("/knowledge/chunk/?spaceName=".concat(n,"&id=").concat(e))};return(null==t?void 0:t.length)?(0,a.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:t.map(e=>{let t;switch(e.status){case"RUNNING":t="#2db7f5";break;case"FINISHED":default:t="#87d068";break;case"FAILED":t="#f50"}return(0,a.jsx)(i.Z,{title:e.result,children:(0,a.jsxs)(l.ZP,{style:{color:t},onClick:()=>{r(e.id)},className:"shrink flex items-center mr-3",children:[(0,a.jsx)(I,{document:e}),e.doc_name]})},e.id)})}):null}var E=function(e){let{children:t,loading:n,onSubmit:c,handleFinish:i,...u}=e,{dbParam:d,scene:m,userId:h}=(0,o.useContext)(j.p),[p,x]=(0,o.useState)(""),f=(0,o.useMemo)(()=>"chat_knowledge"===m,[m]),[_,g]=(0,o.useState)([]),w=(0,o.useRef)(0);async function b(){if(!d)return null;let[e,t]=await (0,y.Vx)((0,y._Q)(d,{page:1,page_size:w.current}));g(null==t?void 0:t.data)}(0,o.useEffect)(()=>{f&&b()},[d]);let N=async()=>{w.current+=1,await b()};return(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(R,{documents:_,dbParam:d}),f&&(0,a.jsx)(P,{handleFinish:i,onUploadFinish:N,className:"absolute z-10 top-2 left-2"}),(0,a.jsx)(r.default.TextArea,{className:"flex-1 ".concat(f?"pl-10":""," pr-10"),size:"large",value:p,autoSize:{minRows:1,maxRows:4},...u,onPressEnter:e=>{if(p.trim()&&13===e.keyCode){if(e.shiftKey){x(e=>e+"\n");return}c(p),setTimeout(()=>{x("")},0)}},onChange:e=>{if("number"==typeof u.maxLength){x(e.target.value.substring(0,u.maxLength));return}x(e.target.value)}}),(0,a.jsx)(l.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:n,icon:(0,a.jsx)(s.Z,{}),onClick:()=>{c(p)}}),(0,a.jsx)(v,{submit:e=>{x(p+e)}}),t]})}},43446:function(e,t,n){"use strict";var a=n(1375),s=n(2453),r=n(67294),l=n(36353),o=n(41468);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions"}=e,n=(0,r.useMemo)(()=>new AbortController,[]),{userId:c}=(0,r.useContext)(o.p),i=(0,r.useCallback)(async e=>{let{data:r,chatId:o,onMessage:i,onClose:u,onDone:d,onError:m}=e;if(!(null==r?void 0:r.user_input)&&!(null==r?void 0:r.doc_id)){s.ZP.warning(l.Z.t("no_context_tip"));return}let h={...r,conv_uid:o,user_id:c};if(!h.conv_uid){s.ZP.error("conv_uid 不存在，请刷新后重试");return}try{await (0,a.L)("".concat("").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),signal:n.signal,openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===a.a)return},onclose(){n.abort(),null==u||u()},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?null==d||d():(null==t?void 0:t.startsWith("[ERROR]"))?null==m||m(null==t?void 0:t.replace("[ERROR]","")):null==i||i(t)}})}catch(e){n.abort(),null==m||m("Sorry, We meet some error, please try agin later.",e)}},[t,c]);return(0,r.useEffect)(()=>()=>{n.abort()},[]),i}},80573:function(e,t,n){"use strict";var a=n(41468),s=n(67294),r=n(43446),l=n(89182);t.Z=()=>{let{history:e,setHistory:t,chatId:n,model:o,docId:c,userId:i}=(0,s.useContext)(a.p),u=(0,r.Z)({queryAgentURL:"/knowledge/document/summary"}),d=(0,s.useCallback)(async e=>{let[,a]=await (0,l.Vx)((0,l.$i)(n,i)),s=[...a,{role:"human",context:"",model_name:o,order:0,time_stamp:0},{role:"view",context:"",model_name:o,order:0,time_stamp:0,retry:!0}],r=s.length-1;t([...s]),await u({data:{doc_id:e||c,model_name:o},chatId:n,onMessage:e=>{s[r].context=e,t([...s])}})},[e,o,c,n]);return d}},57464:function(e,t,n){"use strict";n.r(t);var a=n(85893),s=n(577),r=n(67294),l=n(96074),o=n(75081),c=n(66309),i=n(11163),u=n(25675),d=n.n(u),m=n(89182),h=n(81799),p=n(41468),x=n(19409),f=n(67421),_=n(62418),g=n(53014),j=n(82353),w=n(93967),v=n.n(w);t.default=()=>{let e=(0,i.useRouter)(),{model:t,setModel:n,userId:u,setUserId:w}=(0,r.useContext)(p.p);(0,r.useEffect)(()=>{if(e.isReady){let t=e.query.userId||e.query.userid;t&&(localStorage.setItem("userId",t),w&&w(t)),console.log("page Index",u,localStorage.getItem("userId"))}},[e.isReady,e.query.userId,e.query.userid,w]);let{t:y}=(0,f.$G)(),[b,N]=(0,r.useState)(!1),[Z,P]=(0,r.useState)(!1),{data:k=[]}=(0,s.Z)(async()=>{P(!0);let[,e]=await (0,m.Vx)((0,m.CU)());return P(!1),null!=e?e:[]}),C=async n=>{N(!0);let[,a]=await (0,m.Vx)((0,m.sW)({chat_mode:"chat_normal",user_id:u}));a&&(localStorage.setItem(_.rU,JSON.stringify({id:a.conv_uid,message:n})),e.push("/chat/?scene=chat_normal&userid=".concat(u,"&id=").concat(a.conv_uid).concat(t?"&model=".concat(t):""))),console.log("proxy_llm send"),N(!1)},S=async n=>{if(n.show_disable)return;let[,a]=await (0,m.Vx)((0,m.sW)({chat_mode:"chat_normal",user_id:u}));a&&e.push("/chat?scene=".concat(n.chat_scene,"&userid=").concat(u,"&id=").concat(a.conv_uid).concat(t?"&model=".concat(t):""))};return(0,a.jsx)("div",{className:"px-4 h-screen flex flex-col justify-center items-center overflow-hidden",children:(0,a.jsxs)("div",{className:"max-w-3xl max-h-screen overflow-y-auto",children:[(0,a.jsx)(d(),{src:"/LOGO.png",alt:"Revolutionizing Database Interactions with Private LLM Technology",width:856,height:160,className:"w-full mt-4",unoptimized:!0}),(0,a.jsx)(l.Z,{className:"!text-[#878c93] !my-6",plain:!0,children:y("Quick_Start")}),(0,a.jsx)(o.Z,{spinning:Z,children:(0,a.jsx)("div",{className:"flex flex-wrap -m-1 md:-m-2",children:k.map(e=>(0,a.jsx)("div",{className:"w-full sm:w-1/2 p-1 md:p-2",onClick:()=>{S(e)},children:(0,a.jsxs)("div",{className:v()("flex flex-row justify-center h-[102px] min-h-min bg-white dark:bg-[#232734] dark:text-white rounded p-4 cursor-pointer hover:-translate-y-1 transition-[transform_shadow] duration-300 hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.1)]",{"grayscale !cursor-no-drop":e.show_disable}),children:[function(e){switch(e){case"chat_knowledge":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.je});case"chat_with_db_execute":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.zM});case"chat_excel":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.DL});case"chat_with_db_qa":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.RD});case"chat_dashboard":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.In});case"chat_agent":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.si});case"dbgpt_chat":return(0,a.jsx)(g.Z,{className:"w-10 h-10 mr-4 p-1",component:j.O7});default:return null}}(e.chat_scene),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("h2",{className:"flex items-center text-lg font-sans font-semibold",children:[e.scene_name,e.show_disable&&(0,a.jsx)(c.Z,{className:"ml-2",children:"Comming soon"})]}),(0,a.jsx)("p",{className:"opacity-80 line-clamp-2",children:e.scene_describe})]})]})},e.chat_scene))})}),(0,a.jsx)("div",{className:"mt-8 mb-2",children:(0,a.jsx)(h.Z,{onChange:e=>{n(e)}})}),(0,a.jsx)("div",{className:"flex flex-1 w-full mb-4",children:(0,a.jsx)(x.Z,{loading:b,onSubmit:C})})]})})}},30119:function(e,t,n){"use strict";n.d(t,{Tk:function(){return o},PR:function(){return c}});var a=n(2453),s=n(5121);let r=s.default.create({baseURL:""});r.defaults.timeout=1e4,r.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),n(96486);let l={"content-type":"application/json"},o=(e,t)=>{if(t){let n=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");n&&(e+="?".concat(n))}return r.get("/api"+e,{headers:l}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},c=(e,t)=>r.post(e,t,{headers:l}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[3662,6274,5503,3323,6184,5081,4553,1980,411,2487,9305,7299,9774,2888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);